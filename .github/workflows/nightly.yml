# Nightly build and deployment for development environment

name: Nightly Dev Build & Deploy

on:
  push:
    branches: [master]
  workflow_dispatch:
    inputs:
      ref:
        description: 'Git ref (branch or SHA) to build'
        required: false
        default: 'master'

permissions:
  contents: read

concurrency:
  group: nightly
  cancel-in-progress: true

jobs:
  publish-nightly:
    uses: ./.github/workflows/publish.yml
    with:
      apps: '["smoker", "device-service", "electron-shell", "backend", "frontend"]'
      version: nightly
      ref: ${{ inputs.ref || 'master' }}
      mode: nightly
      platforms: linux/amd64,linux/arm/v7
      prebuild: true
    secrets: inherit

  # deploy-dev:
  #   needs: publish-nightly
  #   uses: ./.github/workflows/cloud-deploy.yml
  #   with:
  #     version: nightly
